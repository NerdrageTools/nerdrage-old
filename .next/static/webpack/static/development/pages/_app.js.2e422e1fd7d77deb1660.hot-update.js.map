{"version":3,"file":"static/webpack/static/development/pages/_app.js.2e422e1fd7d77deb1660.hot-update.js","sources":["webpack:///./pages/_app.js"],"sourcesContent":["import fetch from 'isomorphic-unfetch'\nimport App, { Container } from 'next/app'\nimport React from 'react'\nimport Layout from '@/components/Layout'\nimport Application from '@/contexts/Application'\nimport defaultTheme from '@/data/defaultTheme'\nimport Error from '@/pages/_error'\nimport noop from '@/utilities/noop'\nimport '@/styles/all.scss'\n\nexport default class Wiki extends App {\n  static getInitialProps = async context => {\n    const { Component, ctx: { req: request = {} } } = context\n    const props = await App.getInitialProps(context)\n\n    const fetchParams = { headers: { 'Content-Type': 'application/json' } }\n    const campaign = request\n      ? request.campaign\n      : await fetch('/api/campaign', fetchParams).then(r => r.json())\n    const user = request\n      ? request.user\n      : await fetch('/api/user', fetchParams).then(r => r.json())\n\n    /* eslint-disable prefer-destructuring */\n    let host\n    if (process.browser) {\n      host = window.location.host\n    } else {\n      host = request.get('host')\n    }\n    /* eslint-enable prefer-destructuring */\n\n    const domain = host.split('.').shift()\n    const rootUrl = host.slice(domain.length + 1)\n\n    return { ...props, campaign, Component, domain, rootUrl, user }\n  }\n\n  state = {\n    campaign: this.props.campaign,\n    user: this.props.user,\n  }\n\n  logOff = async event => {\n    event.preventDefault()\n    this.setUser(await fetch('/api/user/auth/logoff').then(r => r.json()))\n    this.updateCampaign()\n  }\n\n  setCampaign = (campaign, callback = noop) => this.setState({ campaign }, callback)\n  setUser = user => this.setState({ user })\n  updateCampaign = async (updates, callback = noop) => {\n    const { campaign } = this.state\n    if (!campaign) { return false }\n\n    const result = await fetch(`/api/campaign/${this.state.campaign.domain}`, {\n      body: updates ? JSON.stringify(updates) : undefined,\n      headers: { 'Content-Type': 'application/json' },\n      method: updates ? 'POST' : 'GET',\n    })\n    const json = await result.json()\n\n    if (result.status === 200) {\n      this.setCampaign(json)\n      return true\n    }\n\n    this.setCampaign({}, callback)\n    return false\n  }\n\n  render = () => {\n    const { Component, domain, pageProps, rootUrl, router } = this.props\n    const { campaign, user } = this.state\n    const theme = (campaign && campaign.theme) || defaultTheme\n    const context = {\n      campaign,\n      domain,\n      logOff: this.logOff,\n      rootUrl,\n      router,\n      setCampaign: this.setCampaign,\n      setUser: this.setUser,\n      theme,\n      updateCampaign: this.updateCampaign,\n      user,\n    }\n\n    const campaignError = !campaign && !['/user', '/login', '/signup'].includes(router.pathname)\n\n    return (\n      <Application.Provider value={context}>\n        <Container>\n          <Layout className={!campaign ? 'no-campaign' : ''}>\n            {campaignError\n              ? <Error\n                  statusCode={404}\n                  message=\"This campaign does not exist.\"\n                />\n              : <Component {...pageProps} />\n            }\n          </Layout>\n          <style>{`\n            :root {\n              --font-primary:     ${theme.fontFamily};\n              --color-background: ${theme.background};\n              --color-borders:    ${theme.primary};\n              --color-foreground: ${theme.foreground};\n              --color-primary:    ${theme.primary};\n              --color-secondary:  ${theme.secondary};\n            }\n          `}</style>\n        </Container>\n      </Application.Provider>\n    )\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;AAFA;AACA;;;;;;AAIA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAEA;AAAA;AACA;AAHA;AAAA;AACA;AADA;AACA;AAEA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAKA;AACA;AAAA;AAAA;AACA;AAHA;AACA;AALA;AAIA;AAJA;AAAA;AACA;AADA;AASA;AACA;AAVA;AAAA;AAAA;AAAA;AACA;AAWA;AACA;AAbA;AACA;AADA;AAgBA;AACA;AAjBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAmBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAaA;AAEA;AACA;AAAA;AAEA;AAAA;AAGA;AACA;AAFA;AAoBA;AACA;;;;;AA1GA;AACA;AADA;;;;;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AACA;AADA;AAEA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AALA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAOA;AAAA;AACA;AARA;AAAA;AACA;AADA;AAKA;AACA;AANA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAUA;AAAA;AACA;AAXA;AAAA;AACA;AADA;AAQA;AACA;AAKA;AACA;AACA,qBAEA;AACA;AACA;AACA;AAAA;AACA;AAtBA;AAwBA;AAAA;AAAA;AAAA;AAAA;AAxBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;A","sourceRoot":""}