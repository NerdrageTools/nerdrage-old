{"version":3,"file":"static/webpack/static/development/pages/_app.js.97b11b334f048c417cb3.hot-update.js","sources":["webpack:///./pages/_app.js"],"sourcesContent":["import fetch from 'isomorphic-unfetch'\nimport App, { Container } from 'next/app'\nimport React from 'react'\nimport Layout from '@/components/Layout'\nimport Application from '@/contexts/Application'\nimport defaultTheme from '@/data/defaultTheme'\nimport Error from '@/pages/_error'\nimport pluck from '@/utilities/pluck'\nimport URI from '@/utilities/URI'\nimport '@/styles/all.scss'\n\nexport default class Wiki extends App {\n  static getInitialProps = async context => {\n    const { Component, ctx: { req } } = context\n    const headers = pluck(req && req.headers, 'cookie')\n    const props = await App.getInitialProps(context)\n    const campaign = await fetch(URI(req, '/api/campaign'), { headers }).then(r => r.json())\n    const user = await fetch(URI(req, '/api/user'), { headers }).then(r => r.json())\n    let host\n\n    /* eslint-disable prefer-destructuring */\n    if (process.browser) {\n      host = window.location.host\n    } else {\n      host = req.get('host')\n    }\n    /* eslint-enable prefer-destructuring */\n\n    const domain = host.split('.').shift()\n    const rootUrl = host.slice(domain.length + 1)\n\n    return {\n      ...props,\n      campaign,\n      Component,\n      domain,\n      rootUrl,\n      user,\n    }\n  }\n\n  state = {\n    campaign: this.props.campaign,\n    user: this.props.user,\n  }\n\n  logOff = async event => {\n    event.preventDefault()\n    await fetch('/api/user/logoff', { method: 'POST' })\n    window.location.href = window.location.href\n  }\n\n  setCampaign = campaign => this.setState({ campaign })\n  setUser = user => this.setState({ user })\n  updateCampaign = async updates => {\n    const { campaign } = this.state\n    if (!campaign) { return false }\n\n    const result = await fetch(`/api/campaign/${this.state.campaign.domain}`, {\n      body: JSON.stringify(updates),\n      headers: { 'Content-Type': 'application/json' },\n      method: 'POST',\n    })\n    const json = await result.json()\n\n    if (result.status === 200) {\n      this.setCampaign(json)\n      console.log(json.navigation.map(l => `${l.slug}:${l._id}`))\n      return true\n    }\n\n    return false\n  }\n\n  render = () => {\n    const { Component, domain, pageProps, rootUrl, router } = this.props\n    const { campaign, user } = this.state\n    const theme = (campaign && campaign.theme) || defaultTheme\n    const context = {\n      campaign,\n      domain,\n      logOff: this.logOff,\n      rootUrl,\n      router,\n      setCampaign: this.setCampaign,\n      setUser: this.setUser,\n      theme,\n      updateCampaign: this.updateCampaign,\n      user,\n    }\n\n    const campaignError = !campaign && !['/user', '/login', '/signup'].includes(router.pathname)\n\n    return (\n      <Application.Provider value={context}>\n        <Container>\n          <Layout className={!campaign ? 'no-campaign' : ''}>\n            {campaignError\n              ? <Error\n                  statusCode={404}\n                  message=\"This campaign does not exist.\"\n                />\n              : <Component {...pageProps} />\n            }\n          </Layout>\n          <style>{`\n            :root {\n              --font-primary:     ${theme.fontFamily};\n              --color-background: ${theme.background};\n              --color-borders:    ${theme.primary};\n              --color-foreground: ${theme.foreground};\n              --color-primary:    ${theme.primary};\n              --color-secondary:  ${theme.secondary};\n            }\n          `}</style>\n        </Container>\n      </Application.Provider>\n    )\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AA8BA;AACA;AACA;AAFA;AACA;;;;;;AAIA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAEA;AAAA;AACA;AAHA;AAGA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAKA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AACA;AADA;AACA;AADA;AAAA;AAAA;AAKA;AACA;AAAA;AAAA;AACA;AAHA;AACA;AALA;AAIA;AAJA;AAAA;AACA;AADA;AASA;AACA;AAVA;AAAA;AAAA;AAAA;AACA;AAWA;AACA;AAAA;AAAA;AAAA;AAbA;AACA;AADA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAmBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAaA;AAEA;AACA;AAAA;AAEA;AAAA;AAGA;AACA;AAFA;AAoBA;AACA;;;;;AA5GA;AACA;AADA;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAFA;AAAA;AACA;AADA;AAGA;AAHA;AAAA;AAIA;AAAA;AAAA;AAAA;AACA;AALA;AAIA;AAJA;AAAA;AAKA;AAAA;AAAA;AAAA;AACA;AANA;AAKA;AACA;AAEA;AACA;AACA;AACA,qBAEA;AACA;AACA;AACA;AAAA;AACA;AAjBA;AAqBA;AACA;AACA;AACA;AACA;AAzBA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;A","sourceRoot":""}