{"version":3,"file":"static/webpack/static/development/pages/campaign.js.efd81e929c8c054581a2.hot-update.js","sources":["webpack:///./pages/campaign.js"],"sourcesContent":["import React, { Component } from 'react'\nimport { Scrollbars } from 'react-custom-scrollbars'\nimport Editable from '@/components/Editable'\nimport PageLink from '@/components/PageLink'\nimport Participants from '@/components/Participants'\nimport Toggle from '@/components/Toggle'\nimport Application from '@/contexts/Application'\nimport PublicIcon from '@/icons/public.svg'\nimport SecretIcon from '@/icons/secret.svg'\nimport ErrorPage from '@/pages/_error'\n// import Article from '@/server/models/Article'\nimport pluck from '@/utilities/pluck'\nimport './campaign.scss'\n\nconst EDITABLE_FIELDS = ['title', 'theme']\nconst STATE_FIELDS = [...EDITABLE_FIELDS, 'isEditor', 'isOwner', 'isPlayer']\n\nexport default class CampaignPage extends Component {\n  static contextType = Application\n\n  state = {\n    ...pluck(this.context.campaign, STATE_FIELDS),\n    savingParticipants: false,\n  }\n\n  // console.log(req.campaign)\n  // const articles = Article.find({  })\n  static getInitialProps = async ({ query, req }) => ({})\n\n  get isDirty() {\n    const { campaign } = this.context\n\n    const fromContext = JSON.stringify(pluck(campaign, EDITABLE_FIELDS))\n    const fromState = JSON.stringify(pluck(this.state, EDITABLE_FIELDS))\n\n    return fromContext !== fromState\n  }\n\n  handleParticipantsSave = ({ editors, owners, players }) => {\n    this.setState({ savingParticipants: true })\n    const update = {\n      editors: editors.map(user => user._id),\n      owners: owners.map(user => user._id),\n      players: players.map(user => user._id),\n    }\n    this.context.updateCampaign(update, () => {\n      console.log('got here')\n      this.setState({ savingParticipants: false })\n    })\n  }\n  handleReset = () => this.setState(pluck(this.context.campaign, STATE_FIELDS))\n  handleSave = () => this.context.updateCampaign(this.state)\n  handleTitleChange = title => this.setState({ title })\n  handleToggleSecret = () => {\n    const { secret } = this.context.campaign\n    this.context.updateCampaign({ secret: !secret })\n  }\n  renderUserList = list => (\n    <ul className=\"user-list\">{list\n      .map(({ _id, name, username }) => (\n        <li key={_id}>\n          <PageLink type=\"user\" slug={username}>\n            {name || username}\n          </PageLink>\n        </li>\n      ))}\n    </ul>\n  )\n  render = () => {\n    const { campaign } = this.context\n    if (!campaign._id) {\n      return <ErrorPage statusCode={404} message={campaign.message} />\n    }\n\n    const { editors, isOwner, owners, players, secret } = campaign\n    const { savingParticipants, title } = this.state\n\n    return (\n      <div className=\"campaign page\">\n        <div className=\"title-bar\">\n          <Editable\n            className=\"title\"\n            onChange={this.handleTitleChange}\n            placeholder=\"Campaign Title\"\n            readOnly={campaign.isEditable}\n            value={title}\n          />\n          {isOwner && (\n            <Toggle\n              className=\"secret\"\n              offIcon={PublicIcon}\n              onIcon={SecretIcon}\n              onToggle={this.handleToggleSecret}\n              value={secret}\n            />\n          )}\n          {this.isDirty && <>\n            <button className=\"safe\" onClick={this.handleSave}>Save</button>\n            <button className=\"safe\" onClick={this.handleReset}>Reset</button>\n          </>}\n        </div>\n        <Scrollbars className=\"contents\" universal autoHide>\n          <div className=\"left column\" />\n          <div className=\"right column\">\n            <Participants\n              className=\"lightbox\"\n              {...{ editors, owners, players }}\n              onSave={this.handleParticipantsSave}\n              saving={savingParticipants}\n            />\n          </div>\n        </Scrollbars>\n      </div>\n    )\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AAIA;AACA;AAIA;AACA;;;AAWA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAHA;AACA;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAFA;AAFA;AACA;AAUA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AALA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AAAA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AALA;AASA;AACA;AACA;AACA;AACA;AALA;AASA;AAAA;AAAA;AACA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AADA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAJA;AAUA;AACA;;;;;;AAtFA;AAAA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;;;;AAnBA;AACA;AADA;AACA;AADA;;;;;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;;;;;A","sourceRoot":""}