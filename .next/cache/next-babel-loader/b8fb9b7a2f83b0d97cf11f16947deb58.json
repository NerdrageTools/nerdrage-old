{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Application } from '~/contexts/Application';\nimport './authPages.scss';\nvar EMAIL_REGEX = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\nvar PASSWORD_REGEX = /^.*(?=.{8,})((?=.*[!@#$%^&*()\\-_=+{};:,<.>]){1})(?=.*\\d)((?=.*[a-z]){1})((?=.*[A-Z]){1}).*$/;\nvar USERNAME_REGEX = /[a-zA-Z0-9_-]{4,}/;\n\nvar SignupPage = /*#__PURE__*/function (_Component) {\n  _inherits(SignupPage, _Component);\n\n  var _super = _createSuper(SignupPage);\n\n  function SignupPage() {\n    var _this;\n\n    _classCallCheck(this, SignupPage);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"state\", {\n      valid: false\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"email\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"name\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"password\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"passwordConfirm\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"username\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"componentDidMount\", function () {\n      _this.name.current.focus();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleEmail\", function (_ref) {\n      var target = _ref.target;\n      // eslint-disable-next-line no-param-reassign\n      target.value = target.value.toLowerCase();\n\n      if (target.value.match(EMAIL_REGEX)) {\n        target.classList.remove('invalid');\n      } else {\n        target.classList.add('invalid');\n      }\n\n      _this.handleValidated();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handlePassword\", function (_ref2) {\n      var target = _ref2.target;\n      var value = target.value;\n\n      if (value.match(PASSWORD_REGEX)) {\n        target.classList.remove('invalid');\n      } else {\n        target.classList.add('invalid');\n      }\n\n      _this.handleValidated();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handlePasswordConfirm\", function (_ref3) {\n      var target = _ref3.target;\n\n      if (target.value === _this.password.current.value) {\n        target.classList.remove('invalid');\n      } else {\n        target.classList.add('invalid');\n      }\n\n      _this.handleValidated();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleUsername\", function (_ref4) {\n      var target = _ref4.target;\n      // eslint-disable-next-line no-param-reassign\n      target.value = target.value.toLowerCase().replace(/[^a-z0-9-_]+/g, '');\n\n      if (target.value.match(USERNAME_REGEX)) {\n        target.classList.remove('invalid');\n      } else {\n        target.classList.add('invalid');\n      }\n\n      _this.handleValidated();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleValidated\", function () {\n      var valid = true;\n      ['email', 'password', 'passwordConfirm', 'username'].forEach(function (key) {\n        var el = _this[key].current;\n\n        if (!el.value || el.matches(':invalid, .invalid')) {\n          valid = false;\n        }\n      });\n\n      _this.setState({\n        valid: valid\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleKeyPress\", function (event) {\n      switch (event.key) {\n        case 'Enter':\n          _this.handleSubmit();\n\n          break;\n\n        case 'Escape':\n          _this.context.router.back();\n\n          break;\n\n        default:\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleSubmit\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var email, name, password, username, response, json;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (_this.state.valid) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              email = _this.email.current.value;\n              name = _this.name.current.value;\n              password = _this.password.current.value;\n              username = _this.username.current.value;\n              _context.next = 8;\n              return fetch('/api/user', {\n                body: JSON.stringify({\n                  email: email,\n                  name: name,\n                  password: password,\n                  username: username\n                }),\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                method: 'PUT'\n              });\n\n            case 8:\n              response = _context.sent;\n              _context.next = 11;\n              return response.json();\n\n            case 11:\n              json = _context.sent;\n\n              if (response.status === 200) {\n                _this.context.router.push(\"/user?username=\".concat(username), \"/user/\".concat(username));\n              } else {\n                _this.setState(_objectSpread({\n                  message: ''\n                }, json));\n              }\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"render\", function () {\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: \"signup page\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"container\",\n          children: [/*#__PURE__*/_jsx(\"h3\", {\n            children: \"Sign Up\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            onChange: _this.handleValidated,\n            onKeyDown: _this.handleKeyPress,\n            placeholder: \"Name (optional)\",\n            ref: _this.name,\n            type: \"text\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            onChange: _this.handleUsername,\n            onKeyDown: _this.handleKeyPress,\n            pattern: \"[a-zA-Z0-9_-]{4,}\",\n            placeholder: \"Username\",\n            ref: _this.username,\n            type: \"text\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"validation-message\",\n            children: \"Length: 4+, letters, numbers, _ & -\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            onChange: _this.handleEmail,\n            onKeyDown: _this.handleKeyPress,\n            placeholder: \"Email Address\",\n            ref: _this.email,\n            type: \"email\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"validation-message\",\n            children: \"Must be a valid e-mail address\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            onChange: _this.handlePassword,\n            onKeyDown: _this.handleKeyPress,\n            placeholder: \"Password\",\n            ref: _this.password,\n            type: \"password\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"validation-message\",\n            children: \"At least 8 characters; must include one a-z, one A-Z, one 0-9 and 1 special character\"\n          }), /*#__PURE__*/_jsx(\"input\", {\n            onChange: _this.handlePasswordConfirm,\n            onKeyDown: _this.handleKeyPress,\n            placeholder: \"Confirm Password\",\n            ref: _this.passwordConfirm,\n            type: \"password\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"validation-message\",\n            children: \"Must match password field\"\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"buttons\",\n            children: _this.state.valid && /*#__PURE__*/_jsx(\"button\", {\n              className: \"safe\",\n              onClick: _this.handleSubmit,\n              children: \"Submit\"\n            })\n          }), /*#__PURE__*/_jsx(\"center\", {\n            className: \"message-field\",\n            children: _this.state.message\n          })]\n        })\n      });\n    });\n\n    return _this;\n  }\n  /* eslint-enable no-useless-escape */\n\n\n  return SignupPage;\n}(Component);\n\n_defineProperty(SignupPage, \"contextType\", Application);\n\nexport { SignupPage as default };","map":null,"metadata":{},"sourceType":"module"}