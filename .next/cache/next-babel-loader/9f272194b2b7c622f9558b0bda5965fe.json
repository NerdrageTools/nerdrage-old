{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport { Scrollbars } from 'react-custom-scrollbars';\nimport Sortable from 'sortablejs';\nimport { Link } from '~/components/Link/Link';\nimport { Application } from '~/contexts/Application';\nimport CampaignIcon from '~/icons/campaign.svg';\nimport EditIcon from '~/icons/edit.svg';\nimport FavoriteIcon from '~/icons/favorite-on.svg';\nimport DeleteIcon from '~/icons/remove.svg';\nimport SheetIcon from '~/icons/sheet.svg';\nimport { noop } from '~/utilities/noop';\nimport { pluck } from '~/utilities/pluck';\nimport prompt from '~/utilities/prompt';\nimport './Navigation.scss';\n\nvar Navigation = /*#__PURE__*/function (_Component) {\n  _inherits(Navigation, _Component);\n\n  var _super = _createSuper(Navigation);\n\n  function Navigation() {\n    var _this;\n\n    _classCallCheck(this, Navigation);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"campaignNav\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"initializeSortable\", function () {\n      if (!_this.campaignNav.current) return;\n      if (_this.sortable) _this.sortable.destroy();\n\n      var ul = _this.campaignNav.current.querySelector('ul');\n\n      var navigation = _this.context.campaign.navigation;\n      _this.sortable = Sortable.create(ul, {\n        disabled: !_this.isCampaignEditor || _this.context.size === 'small',\n        dragClass: 'dragging',\n        draggable: 'li',\n        onEnd: function onEnd() {\n          var updated = _toConsumableArray(ul.querySelectorAll('li')).map(function (li) {\n            return li.getAttribute('data-id');\n          }).map(function (id) {\n            return navigation.find(function (navLink) {\n              return navLink._id === id;\n            });\n          }).filter(Boolean);\n\n          _this.context.updateCampaign({\n            navigation: updated\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"promptForLinkDetails\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var item,\n          title,\n          slug,\n          _args = arguments;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              item = _args.length > 0 && _args[0] !== undefined ? _args[0] : {};\n              _context.prev = 1;\n              _context.next = 4;\n              return prompt('New Title?', {\n                defaultValue: item.title,\n                title: 'Set Title'\n              });\n\n            case 4:\n              title = _context.sent;\n\n              if (title) {\n                _context.next = 7;\n                break;\n              }\n\n              return _context.abrupt(\"return\", undefined);\n\n            case 7:\n              _context.next = 9;\n              return prompt('Slug to link to?', {\n                defaultValue: item.slug,\n                placeholder: 'Leave blank to create a header...',\n                title: 'Set Slug'\n              });\n\n            case 9:\n              slug = _context.sent;\n              return _context.abrupt(\"return\", {\n                slug: slug,\n                title: title\n              });\n\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context[\"catch\"](1);\n              return _context.abrupt(\"return\", null);\n\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 13]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleAddLink\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var newLink;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _this.promptForLinkDetails();\n\n            case 2:\n              newLink = _context2.sent;\n\n              if (newLink) {\n                _context2.next = 5;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 5:\n              _this.context.updateCampaign({\n                navigation: [].concat(_toConsumableArray(_this.context.campaign.navigation), [newLink])\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"handleDelete\", function (_ref3) {\n      var currentTarget = _ref3.currentTarget;\n      var id = currentTarget.getAttribute('data-id');\n      var navigation = _this.context.campaign.navigation;\n\n      _this.context.updateCampaign({\n        navigation: navigation.filter(function (item) {\n          return item._id !== id;\n        })\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleEdit\", /*#__PURE__*/function () {\n      var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(_ref4) {\n        var currentTarget, id, navigation, item, edited;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                currentTarget = _ref4.currentTarget;\n                id = currentTarget.getAttribute('data-id');\n                navigation = _toConsumableArray(_this.context.campaign.navigation);\n                item = navigation.find(function (navItem) {\n                  return navItem._id === id;\n                });\n\n                if (item) {\n                  _context3.next = 6;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 6:\n                _context3.next = 8;\n                return _this.promptForLinkDetails(item);\n\n              case 8:\n                edited = _context3.sent;\n\n                if (edited) {\n                  _context3.next = 11;\n                  break;\n                }\n\n                return _context3.abrupt(\"return\");\n\n              case 11:\n                navigation.splice(navigation.indexOf(item), 1, edited);\n\n                _this.context.updateCampaign({\n                  navigation: navigation\n                });\n\n              case 13:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }));\n\n      return function (_x) {\n        return _ref5.apply(this, arguments);\n      };\n    }());\n\n    _defineProperty(_assertThisInitialized(_this), \"renderList\", function () {\n      var list = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      var listTitle = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'article';\n      var campaignLink = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n      return /*#__PURE__*/_jsxs(_Fragment, {\n        children: [(campaignLink || Boolean(list.length)) && /*#__PURE__*/_jsx(\"div\", {\n          className: \"list-title\",\n          children: campaignLink || listTitle\n        }), /*#__PURE__*/_jsx(\"ul\", {\n          children: list.map(function (_ref6, index) {\n            var _id = _ref6._id,\n                campaign = _ref6.campaign,\n                slug = _ref6.slug,\n                title = _ref6.title;\n\n            var _ref7 = campaign || _this.context.campaign || {},\n                _ref7$subdomain = _ref7.subdomain,\n                subdomain = _ref7$subdomain === void 0 ? '' : _ref7$subdomain,\n                _ref7$title = _ref7.title,\n                cTitle = _ref7$title === void 0 ? '' : _ref7$title;\n\n            var text = title;\n\n            if (type !== 'campaign' && subdomain && subdomain !== _this.context.subdomain) {\n              text += \" (\".concat(cTitle || subdomain, \")\");\n            }\n\n            if (!slug) {\n              return /*#__PURE__*/_jsxs(\"li\", {\n                className: \"section\",\n                \"data-id\": _id,\n                title: title,\n                children: [/*#__PURE__*/_jsx(\"b\", {\n                  children: text\n                }), _this.context.campaign.isEditor && /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"controls\",\n                  children: [/*#__PURE__*/_jsx(EditIcon, {\n                    className: \"edit\",\n                    \"data-id\": _id,\n                    onClick: _this.handleEdit\n                  }), /*#__PURE__*/_jsx(DeleteIcon, {\n                    className: \"delete\",\n                    \"data-id\": _id,\n                    onClick: _this.handleDelete\n                  })]\n                })]\n              }, _id || index);\n            }\n\n            return /*#__PURE__*/_jsxs(\"li\", {\n              \"data-id\": _id,\n              title: title,\n              children: [/*#__PURE__*/_jsx(Link, _objectSpread(_objectSpread({}, {\n                campaign: campaign,\n                slug: slug,\n                type: type\n              }), {}, {\n                active: _this.context.subdomain === subdomain && _this.context.router.asPath === \"/\".concat(type, \"/\").concat(slug),\n                onClick: _this.props.onItemClick,\n                children: text\n              })), _this.context.campaign.isEditor && /*#__PURE__*/_jsxs(\"div\", {\n                className: \"controls\",\n                children: [/*#__PURE__*/_jsx(EditIcon, {\n                  className: \"edit\",\n                  \"data-id\": _id,\n                  onClick: _this.handleEdit\n                }), /*#__PURE__*/_jsx(DeleteIcon, {\n                  className: \"delete\",\n                  \"data-id\": _id,\n                  onClick: _this.handleDelete\n                })]\n              })]\n            }, _id || index);\n          })\n        })]\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"filterLinks\", function (link) {\n      return link.campaign.subdomain === _this.context.campaign.subdomain;\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"render\", function () {\n      var _this$context = _this.context,\n          campaign = _this$context.campaign,\n          _this$context$user = _this$context.user,\n          user = _this$context$user === void 0 ? {} : _this$context$user;\n      var _user$favorites = user.favorites,\n          favorites = _user$favorites === void 0 ? [] : _user$favorites,\n          _user$sheets = user.sheets,\n          sheets = _user$sheets === void 0 ? [] : _user$sheets;\n      if (!campaign || !campaign.navigation) return null;\n      var navigation = campaign.navigation.map(function (link) {\n        return _objectSpread(_objectSpread({}, link), {}, {\n          campaign: pluck(campaign, '_id', 'subdomain', 'title')\n        });\n      });\n      favorites = favorites.filter(_this.filterLinks);\n      sheets = sheets.filter(_this.filterLinks);\n      return /*#__PURE__*/_jsxs(\"div\", {\n        className: \"navigation\",\n        children: [/*#__PURE__*/_jsx(Scrollbars, {\n          className: \"scrollbars link-sections\",\n          autoHide: true,\n          universal: true,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"content\",\n            ref: _this.props.wrapperRef,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"campaign-nav\",\n              ref: _this.campaignNav,\n              children: _this.renderList(navigation, campaign.title, 'article', /*#__PURE__*/_jsxs(_Fragment, {\n                children: [/*#__PURE__*/_jsx(CampaignIcon, {}), /*#__PURE__*/_jsx(Link, {\n                  subdomain: campaign.subdomain,\n                  type: \"campaign\",\n                  children: campaign.title\n                })]\n              }))\n            }), user && /*#__PURE__*/_jsxs(_Fragment, {\n              children: [Boolean(favorites.length) && _this.renderList(favorites, /*#__PURE__*/_jsxs(_Fragment, {\n                children: [/*#__PURE__*/_jsx(FavoriteIcon, {}), \" Favorites\"]\n              })), Boolean(sheets.length) && _this.renderList(sheets, /*#__PURE__*/_jsxs(_Fragment, {\n                children: [/*#__PURE__*/_jsx(SheetIcon, {}), \" Sheets\"]\n              }), 'sheet')]\n            })]\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"footer\",\n          children: [campaign.isEditor && /*#__PURE__*/_jsx(\"div\", {\n            className: \"buttons\",\n            children: /*#__PURE__*/_jsx(\"button\", {\n              className: \"add safe\",\n              onClick: _this.handleAddLink,\n              children: \"Add Link\"\n            })\n          }), /*#__PURE__*/_jsx(Link, {\n            subdomain: \"www\",\n            slug: \"tos\",\n            type: \"article\",\n            children: \"Terms of Service\"\n          })]\n        })]\n      });\n    });\n\n    return _this;\n  }\n\n  _createClass(Navigation, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initializeSortable();\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.initializeSortable();\n    }\n  }, {\n    key: \"isCampaignEditor\",\n    get: function get() {\n      return Boolean(this.context.campaign && this.context.campaign.isEditor);\n    }\n  }]);\n\n  return Navigation;\n}(Component);\n\n_defineProperty(Navigation, \"contextType\", Application);\n\n_defineProperty(Navigation, \"defaultProps\", {\n  items: [],\n  onItemClick: noop,\n  wrapperRef: noop\n});\n\nexport { Navigation as default };","map":null,"metadata":{},"sourceType":"module"}