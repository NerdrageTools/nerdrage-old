{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport FlyoutMenu, { MenuItem } from '~/components/FlyoutMenu/FlyoutMenu';\nimport { Application } from '~/contexts/Application';\nimport ArticleIcon from '~/icons/read.svg';\nimport SheetIcon from '~/icons/sheet.svg';\nimport alert from '~/utilities/alert';\nimport promptLink from '~/utilities/promptLink';\nimport './CreateMenu.scss';\n\nvar CreateMenu = /*#__PURE__*/function (_Component) {\n  _inherits(CreateMenu, _Component);\n\n  var _super = _createSuper(CreateMenu);\n\n  function CreateMenu() {\n    var _this;\n\n    _classCallCheck(this, CreateMenu);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _super.call.apply(_super, [this].concat(args));\n\n    _defineProperty(_assertThisInitialized(_this), \"flyoutMenu\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(_assertThisInitialized(_this), \"handleNew\", function (type) {\n      return /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var lowered, _yield$promptLink, slug, templateSlug, text, href, asUrl;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this.flyoutMenu.current.close();\n\n                lowered = type.toLowerCase();\n                _context.prev = 2;\n                _context.next = 5;\n                return promptLink({\n                  defaultSlug: \"new-\".concat(lowered),\n                  defaultText: \"New \".concat(type),\n                  templateType: type,\n                  title: \"New \".concat(type, \"...\")\n                });\n\n              case 5:\n                _yield$promptLink = _context.sent;\n                slug = _yield$promptLink.slug;\n                templateSlug = _yield$promptLink.templateSlug;\n                text = _yield$promptLink.text;\n                href = \"/\".concat(lowered, \"?slug=\").concat(slug, \"&title=\").concat(text);\n                asUrl = \"/\".concat(lowered, \"/\").concat(slug, \"?title=\").concat(text);\n\n                if (templateSlug) {\n                  href += \"&template=\".concat(templateSlug);\n                  asUrl += \"&template=\".concat(templateSlug);\n                }\n\n                _this.context.router.push(href, asUrl);\n\n                _context.next = 17;\n                break;\n\n              case 15:\n                _context.prev = 15;\n                _context.t0 = _context[\"catch\"](2);\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[2, 15]]);\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handleNewCampaign\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var rootUrl, _yield$promptLink2, slug, text, response, json;\n\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              rootUrl = _this.context.rootUrl;\n\n              _this.flyoutMenu.current.close();\n\n              _context2.prev = 2;\n              _context2.next = 5;\n              return promptLink({\n                defaultSlug: 'new-campaign',\n                defaultText: 'New Campaign',\n                slugLabel: 'Subdomain',\n                textLabel: 'Title',\n                title: 'New Campaign...'\n              });\n\n            case 5:\n              _yield$promptLink2 = _context2.sent;\n              slug = _yield$promptLink2.slug;\n              text = _yield$promptLink2.text;\n              _context2.next = 10;\n              return fetch(\"/api/campaign/\".concat(slug), {\n                body: JSON.stringify({\n                  subdomain: slug,\n                  title: text\n                }),\n                credentials: 'include',\n                method: 'PUT'\n              });\n\n            case 10:\n              response = _context2.sent;\n\n              if (!(response.status === 201)) {\n                _context2.next = 15;\n                break;\n              }\n\n              _this.context.router.push(\"//\".concat(slug, \".\").concat(rootUrl, \"/campaign\"), \"//\".concat(slug, \".\").concat(rootUrl, \"/campaign\"));\n\n              _context2.next = 19;\n              break;\n\n            case 15:\n              _context2.next = 17;\n              return response.json();\n\n            case 17:\n              json = _context2.sent;\n              alert(json.message, 'Error');\n\n            case 19:\n              _context2.next = 23;\n              break;\n\n            case 21:\n              _context2.prev = 21;\n              _context2.t0 = _context2[\"catch\"](2);\n\n            case 23:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[2, 21]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"render\", function () {\n      var children = _this.props.children;\n\n      var _ref3 = _this.context.campaign || {},\n          isEditor = _ref3.isEditor,\n          isParticipant = _ref3.isParticipant;\n\n      var _ref4 = _this.context.user || {},\n          isAdmin = _ref4.isAdmin;\n\n      return /*#__PURE__*/_jsxs(FlyoutMenu, {\n        className: \"create\",\n        ref: _this.flyoutMenu,\n        children: [isAdmin && /*#__PURE__*/_jsxs(MenuItem, {\n          onClick: _this.handleNewCampaign,\n          children: [/*#__PURE__*/_jsx(SheetIcon, {}), \" New Campaign...\"]\n        }), isEditor && /*#__PURE__*/_jsxs(MenuItem, {\n          onClick: _this.handleNew('Article'),\n          children: [/*#__PURE__*/_jsx(ArticleIcon, {}), \" New Article...\"]\n        }), isParticipant && /*#__PURE__*/_jsxs(MenuItem, {\n          onClick: _this.handleNew('Sheet'),\n          children: [/*#__PURE__*/_jsx(SheetIcon, {}), \" New Sheet...\"]\n        }), /*#__PURE__*/_jsx(\"hr\", {}), children]\n      });\n    });\n\n    return _this;\n  }\n\n  return CreateMenu;\n}(Component);\n\n_defineProperty(CreateMenu, \"contextType\", Application);\n\nexport { CreateMenu as default };","map":null,"metadata":{},"sourceType":"module"}